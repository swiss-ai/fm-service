---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import ModelList from "@components/ui/ModelList.svelte";
import TokenUsageChart from "@components/TokenUsageChart.svelte";
import Link from "@components/Link.astro";
import ContributorCard from "@components/ContributorCard.astro";
import SponsorCard from "@components/SponsorCard.astro";
import CSCSLogo from "@components/CSCSLogo.astro";
import { SITE, HOME } from "@consts";
import { SignIn, SignOut } from 'auth-astro/components';
import { getSession } from 'auth-astro/server';

export const prerender = false;
const docs = (await getCollection("guides"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_POSTS_ON_HOMEPAGE);

const articles = (await getCollection("articles"))
  .filter(articles => !articles.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_PROJECTS_ON_HOMEPAGE);

const session = await getSession(Astro.request);
const isSessionValid = session && session.user;

const contributors = [
  {
    name: "Ilia Badanin",
    role: "Student Engineer",
    avatar: "https://media.licdn.com/dms/image/v2/D4E03AQFqYhBtxqAAXg/profile-displayphoto-shrink_400_400/profile-displayphoto-shrink_400_400/0/1719241055758?e=1753315200&v=beta&t=78v5d8kcIW9tkuvoOkFHkOM52samJi3wYO_S4M7ZIVc",
    url: "https://ch.linkedin.com/in/ilia-badanin"
  },
  {
    name: "Alexander Sternfeld",
    role: "Research Associate ",
    avatar: "https://www.hevs.ch/media/image/22/medium_1_1/alexandersternfeld.jpg?d749fde86e3b15159bd96cdaef165f2f",
    url: "https://www.linkedin.com/in/alexander-sternfeld-93a01799/"
  },
  {
    name: "Xiaozhe Yao",
    role: "Project Lead",
    avatar: "https://avatars.githubusercontent.com/u/10499297?v=4",
    url: "https://about.yao.sh"
  },
  {
    name: "Imanol Schlag",
    role: "Project Lead",
    avatar: "https://ai.ethz.ch/about-us/people/executive-office/_jcr_content/par/twocolumn_687649423/par_left/textimage/image.imageformat.textdouble.1425254353.png",
    url: "https://ischlag.github.io/about/"
  }
];

const sponsors = [
  {
    name: "CSCS",
    logo: "/cscs-logo.svg",
    component: CSCSLogo
  },
  {
    name: "ETH Zurich",
    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/ETH_Z%C3%BCrich_Logo_black.svg/1200px-ETH_Z%C3%BCrich_Logo_black.svg.png"
  },
  {
    name: "ETHZ AI Center",
    logo: "https://ai.ethz.ch/_jcr_content/orgbox/image.imageformat.logo.1864120785.png"
  },
  {
    name: "Langfuse",
    logo: "https://langfuse.com/langfuse_logo.svg"
  }
];
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <!-- Hero Section -->
    <div class="text-center mb-16">
      <h1 class="animate text-5xl md:text-6xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-6">
        Welcome to {SITE.NAME}
      </h1>
      <p class="animate text-xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto leading-relaxed">
        A research platform for serving foundation models in a decentralized, cost-efficient way
      </p>
    </div>
    
    <!-- Authentication Section -->
    <div class="animate mb-12">
      {isSessionValid ? (
        <div class="card-modern p-8 rounded-2xl">
          <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-white text-lg"></i>
              </div>
              <div>
                <p class="text-sm font-medium text-slate-600 dark:text-slate-400">Logged in as</p>
                <p class="text-xl font-bold text-slate-900 dark:text-slate-100">{session.user?.name || 'User'}</p>
              </div>
            </div>
            <div class="flex gap-4">
              <a href="/api_key" class="btn-accent py-3 px-6 rounded-lg font-semibold">
                <i class="fas fa-key mr-2"></i>
                View API Key
              </a>
              <SignOut class="bg-slate-500 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 hover:-translate-y-0.5 shadow-lg">
                <i class="fas fa-sign-out-alt mr-2"></i>
                Logout
              </SignOut>
            </div>
          </div>
        </div>
      ) : (
        <div class="card-modern p-8 rounded-2xl">
          <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center">
                <i class="fas fa-lock text-white text-lg"></i>
              </div>
              <div>
                <p class="text-xl font-bold text-slate-900 dark:text-slate-100 mb-2">Get Started</p>
                <p class="text-slate-600 dark:text-slate-400">
                  Sign in to get your API key and access our LLM services.
                </p>
              </div>
            </div>
            <SignIn provider="auth0" class="btn-primary py-3 px-8 rounded-lg font-semibold">
              <i class="fas fa-sign-in-alt mr-2"></i>
              Login
            </SignIn>
          </div>
        </div>
      )}
    </div>
    
    <!-- Action Buttons -->
    <div class="animate flex flex-col sm:flex-row gap-6 mb-20 justify-center">
      <a href="https://chat.swissai.cscs.ch" target="_blank" rel="noopener noreferrer"
         class="btn-primary py-4 px-8 rounded-xl font-semibold text-lg flex items-center justify-center gap-3 min-w-[200px]">
        <i class="fas fa-comments text-xl"></i>
        Swiss AI Chat
      </a>
      <a href="/arena/" target="_blank" rel="noopener noreferrer"
         class="btn-secondary py-4 px-8 rounded-xl font-semibold text-lg flex items-center justify-center gap-3 min-w-[200px]">
        <i class="fas fa-trophy text-xl"></i>
        LM Arena
      </a>
    </div>

    <div class="space-y-24">
      <!-- About Section -->
      <section class="animate">
        <div class="card-modern p-8 rounded-2xl">
          <div class="max-w-4xl mx-auto text-center space-y-6">
            <h2 class="text-3xl font-bold text-slate-900 dark:text-slate-100 mb-6">About Our Platform</h2>
            <p class="text-lg text-slate-700 dark:text-slate-300 leading-relaxed">
              {SITE.NAME} is based on Research Computer, which is a research platform for serving foundation models in a decentralized, cost-efficient way.
            </p>
            <div class="bg-blue-50 dark:bg-slate-800 p-6 rounded-xl border-l-4 border-blue-500">
              <h3 class="font-semibold text-slate-900 dark:text-slate-100 mb-3">Terms and Conditions</h3>
              <p class="text-slate-700 dark:text-slate-300">
                By using the platform, you agree to allow us to collect metadata of your requests, including but not limited to token length, timestamp, requested models, etc, for research purpose and to improve the service.
              </p>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Models Section -->
      <section class="animate">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-bold text-slate-900 dark:text-slate-100 mb-4">Available Models</h2>
          <p class="text-xl text-slate-600 dark:text-slate-400">Models currently available on the platform</p>
        </div>
        <div class="card-modern p-8 rounded-2xl">
          <ModelList client:load />
        </div>
      </section>

      <!-- Statistics Section -->
      <section class="animate">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-bold text-slate-900 dark:text-slate-100 mb-4">Usage Statistics</h2>
          <p class="text-xl text-slate-600 dark:text-slate-400">Real-time token usage across our platform</p>
        </div>
        <div class="card-modern p-8 rounded-2xl">
          <TokenUsageChart client:load />
        </div>
      </section>
      
      <!-- Documentation Section -->
      <section class="animate space-y-8">
        <div class="flex flex-wrap gap-y-4 items-center justify-between">
          <div>
            <h2 class="text-4xl font-bold text-slate-900 dark:text-slate-100 mb-2">Documentation</h2>
            <p class="text-xl text-slate-600 dark:text-slate-400">Comprehensive guides to get you started</p>
          </div>
          <Link href="/guides" class="btn-primary py-3 px-6 rounded-lg font-semibold">
            View All Docs
          </Link>
        </div>
        <div class="grid gap-6">
          {docs.map(post => (
            <div class="animate">
              <ArrowCard entry={post} />
            </div>
          ))}
        </div>
      </section>

      <!-- Research Articles Section -->
      <section class="animate space-y-8">
        <div class="flex flex-wrap gap-y-4 items-center justify-between">
          <div>
            <h2 class="text-4xl font-bold text-slate-900 dark:text-slate-100 mb-2">Research Articles</h2>
            <p class="text-xl text-slate-600 dark:text-slate-400">Latest research and insights</p>
          </div>
          <Link href="/articles" class="btn-primary py-3 px-6 rounded-lg font-semibold">
            View All Articles
          </Link>
        </div>
        <div class="grid gap-6">
          {articles.map(article => (
            <div class="animate">
              <ArrowCard entry={article} />
            </div>
          ))}
        </div>
      </section>

      <!-- Contributors Section -->
      <section class="animate space-y-8">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-bold text-slate-900 dark:text-slate-100 mb-4">Our Team</h2>
          <p class="text-xl text-slate-600 dark:text-slate-400">Meet the contributors behind the serving platform</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          {contributors.map(contributor => (
            <div class="animate">
              <ContributorCard {...contributor} />
            </div>
          ))}
        </div>
      </section>

      <!-- Sponsors Section -->
      <section class="animate space-y-8">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-bold text-slate-900 dark:text-slate-100 mb-4">Our Partners</h2>
          <p class="text-xl text-slate-600 dark:text-slate-400">Proudly supported by leading institutions</p>
        </div>
        <div class="card-modern p-12 rounded-2xl">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-12 items-center justify-items-center">
            {sponsors.map(sponsor => (
              sponsor.component ? (
                <div class="animate opacity-70 hover:opacity-100 transition-opacity duration-300">
                  <sponsor.component class="max-h-16 w-auto object-contain" width={158} height={64} />
                </div>
              ) : (
                <div class="animate opacity-70 hover:opacity-100 transition-opacity duration-300">
                  <SponsorCard {...sponsor} />
                </div>
              )
            ))}
          </div>
        </div>
      </section>
      
    </div>
  </Container>
</PageLayout>