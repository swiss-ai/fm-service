---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import ModelList from "@components/ui/ModelList.svelte";
import TokenUsageChart from "@components/TokenUsageChart.svelte";
import Link from "@components/Link.astro";
import ContributorCard from "@components/ContributorCard.astro";
import SponsorCard from "@components/SponsorCard.astro";
import CSCSLogo from "@components/CSCSLogo.astro";
import { SITE, HOME } from "@consts";
import { SignIn, SignOut } from 'auth-astro/components';
import { getSession } from 'auth-astro/server';

export const prerender = false;
const docs = (await getCollection("guides"))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_POSTS_ON_HOMEPAGE);

const articles = (await getCollection("articles"))
  .filter(articles => !articles.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0,SITE.NUM_PROJECTS_ON_HOMEPAGE);

const session = await getSession(Astro.request);
const isSessionValid = session && session.user;

const contributors = [
  {
    name: "Ilia Badanin",
    role: "Student Engineer",
    avatar: "https://media.licdn.com/dms/image/v2/D4E03AQFqYhBtxqAAXg/profile-displayphoto-shrink_400_400/profile-displayphoto-shrink_400_400/0/1719241055758?e=1753315200&v=beta&t=78v5d8kcIW9tkuvoOkFHkOM52samJi3wYO_S4M7ZIVc",
    url: "https://ch.linkedin.com/in/ilia-badanin"
  },
  {
    name: "Alexander Sternfeld",
    role: "Research Associate ",
    avatar: "https://www.hevs.ch/media/image/22/medium_1_1/alexandersternfeld.jpg?d749fde86e3b15159bd96cdaef165f2f",
    url: "https://www.linkedin.com/in/alexander-sternfeld-93a01799/"
  },
  {
    name: "Xiaozhe Yao",
    role: "Project Lead",
    avatar: "https://avatars.githubusercontent.com/u/10499297?v=4",
    url: "https://about.yao.sh"
  },
  {
    name: "Imanol Schlag",
    role: "Project Lead",
    avatar: "https://ai.ethz.ch/about-us/people/executive-office/_jcr_content/par/twocolumn_687649423/par_left/textimage/image.imageformat.textdouble.1425254353.png",
    url: "https://ischlag.github.io/about/"
  }
];

const sponsors = [
  {
    name: "CSCS",
    logo: "/cscs-logo.svg",
    component: CSCSLogo
  },
  {
    name: "ETH Zurich",
    logo: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/ETH_Z%C3%BCrich_Logo_black.svg/1200px-ETH_Z%C3%BCrich_Logo_black.svg.png"
  },
  {
    name: "ETHZ AI Center",
    logo: "https://ai.ethz.ch/_jcr_content/orgbox/image.imageformat.logo.1864120785.png"
  },
  {
    name: "Langfuse",
    logo: "https://langfuse.com/langfuse_logo.svg"
  }
];
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <!-- Hero Section -->
    <div class="relative overflow-hidden bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 rounded-3xl p-8 mb-12 shadow-xl border border-gray-200/50 dark:border-gray-700/50">
      <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
      <div class="relative z-10">
        <h1 class="animate text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-blue-800 bg-clip-text text-transparent mb-4">
          Welcome to {SITE.NAME} <span class="text-4xl">üëãüèª</span> 
        </h1>
        <p class="animate text-lg text-gray-600 dark:text-gray-300 mb-8 max-w-2xl">
          A cutting-edge research platform for serving foundation models in a decentralized, cost-efficient way.
        </p>
      </div>
    </div>
    
    <!-- Authentication Section -->
    <div class="animate mb-12">
      {isSessionValid ? (
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-white text-lg"></i>
              </div>
              <div>
                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Logged in as</p>
                <p class="text-lg font-semibold text-gray-900 dark:text-white">{session.user?.name || 'User'}</p>
              </div>
            </div>
            <div class="flex gap-3">
              <a href="/api_key" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium py-3 px-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-key mr-2"></i>View API Key
              </a>
              <SignOut class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-medium py-3 px-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
              </SignOut>
            </div>
          </div>
        </div>
      ) : (
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center">
                <i class="fas fa-lock text-white text-lg"></i>
              </div>
              <div>
                <p class="text-lg font-semibold text-gray-900 dark:text-white mb-1">Get Started</p>
                <p class="text-gray-600 dark:text-gray-300">Sign in to get your API key and access our LLM services.</p>
              </div>
            </div>
            <SignIn provider="auth0" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium py-3 px-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-200 transform hover:scale-105">
              <i class="fas fa-sign-in-alt mr-2"></i>Login
            </SignIn>
          </div>
        </div>
      )}
    </div>
    
    <!-- Action Buttons -->
    <div class="animate mb-16">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <a href="https://chat.swissai.cscs.ch" target="_blank" rel="noopener noreferrer"
           class="group relative overflow-hidden bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 text-white font-semibold py-6 px-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
          <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10 flex items-center justify-center gap-3">
            <i class="fas fa-comments text-2xl"></i>
            <div class="text-left">
              <div class="text-xl font-bold">Swiss AI Chat</div>
              <div class="text-blue-100 text-sm">Interactive AI conversations</div>
            </div>
          </div>
        </a>
        <a href="/arena/" target="_blank" rel="noopener noreferrer"
           class="group relative overflow-hidden bg-gradient-to-br from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white font-semibold py-6 px-8 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105">
          <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="relative z-10 flex items-center justify-center gap-3">
            <i class="fas fa-trophy text-2xl"></i>
            <div class="text-left">
              <div class="text-xl font-bold">LM Arena</div>
              <div class="text-purple-100 text-sm">Compare model performance</div>
            </div>
          </div>
        </a>
      </div>
    </div>

    <div class="space-y-20">
      <!-- About Section -->
      <section class="animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-info-circle text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">About the Platform</h2>
          </div>
          <article class="space-y-6">
            <p class="text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
              {SITE.NAME} is based on Research Computer, which is a research platform for serving foundation models in a decentralized, cost-efficient way.
            </p>
            <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-6">
              <h3 class="text-lg font-semibold text-amber-800 dark:text-amber-200 mb-3 flex items-center gap-2">
                <i class="fas fa-exclamation-triangle"></i>
                Terms and Conditions
              </h3>
              <p class="text-amber-700 dark:text-amber-300 mb-3">
                By using the platform, you agree to the following terms and conditions:
              </p>
              <ul class="text-amber-700 dark:text-amber-300 space-y-2">
                <li class="flex items-start gap-2">
                  <i class="fas fa-check-circle text-amber-600 dark:text-amber-400 mt-1 text-sm"></i>
                  <span>You allow us to collect metadata of your requests, including but not limited to token length, timestamp, requested models, etc, for research purpose and to improve the service.</span>
                </li>
              </ul>
            </div>
          </article>
        </div>
      </section>
      
      <!-- Models Section -->
      <section class="animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-robot text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Available Models</h2>
          </div>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            Explore our collection of cutting-edge language models:
          </p>
          <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-6">
            <ModelList client:load />
          </div>
        </div>
      </section>

      <!-- Statistics Section -->
      <section class="animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-chart-bar text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Usage Analytics</h2>
          </div>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            Real-time token usage statistics across all models:
          </p>
          <div class="bg-gray-50 dark:bg-gray-900/50 rounded-xl p-6">
            <TokenUsageChart client:load />
          </div>
        </div>
      </section>
      
      <!-- Documentation Section -->
      <section class="animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex flex-wrap gap-y-4 items-center justify-between mb-8">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-book text-white"></i>
              </div>
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Documentation</h2>
            </div>
            <Link href="/guides" class="bg-blue-100 hover:bg-blue-200 dark:bg-blue-900 dark:hover:bg-blue-800 text-blue-700 dark:text-blue-300 font-medium py-2 px-4 rounded-lg transition-colors">
              See all docs ‚Üí
            </Link>
          </div>
          <ul class="grid grid-cols-1 gap-4">
            {docs.map(post => (
              <li class="transform hover:scale-[1.02] transition-transform duration-200">
                <ArrowCard entry={post} />
              </li>
            ))}
          </ul>
        </div>
      </section>

      <!-- Research Articles Section -->
      <section class="animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex flex-wrap gap-y-4 items-center justify-between mb-8">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-red-400 to-red-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-newspaper text-white"></i>
              </div>
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Research Articles</h2>
            </div>
            <Link href="/articles" class="bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-700 dark:text-red-300 font-medium py-2 px-4 rounded-lg transition-colors">
              See all posts ‚Üí
            </Link>
          </div>
          <ul class="grid grid-cols-1 gap-4">
            {articles.map(article => (
              <li class="transform hover:scale-[1.02] transition-transform duration-200">
                <ArrowCard entry={article} />
              </li>
            ))}
          </ul>
        </div>
      </section>

      <!-- Contributors Section -->
      <section class="animate">
        <div class="bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex items-center gap-3 mb-8">
            <div class="w-10 h-10 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-users text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Contributors</h2>
          </div>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            Meet the talented team behind the serving platform:
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {contributors.map(contributor => (
              <div class="transform hover:scale-105 transition-transform duration-200">
                <ContributorCard {...contributor} />
              </div>
            ))}
          </div>
        </div>
      </section>

      <!-- Sponsors Section -->
      <section class="animate">
        <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl p-8 shadow-lg border border-gray-200/50 dark:border-gray-700/50">
          <div class="flex items-center gap-3 mb-8">
            <div class="w-10 h-10 bg-gradient-to-br from-indigo-400 to-indigo-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-handshake text-white"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Our Partners</h2>
          </div>
          <div class="py-8">
            <div class="mx-auto max-w-7xl">
              <div class="mx-auto grid max-w-lg grid-cols-2 items-center gap-x-8 gap-y-12 sm:max-w-xl sm:grid-cols-3 sm:gap-x-10 sm:gap-y-14 lg:mx-0 lg:max-w-none lg:grid-cols-4">
                {sponsors.map(sponsor => (
                  <div class="transform hover:scale-110 transition-transform duration-200 bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md hover:shadow-lg">
                    {sponsor.component ? (
                      <sponsor.component class="col-span-2 max-h-12 w-full object-contain lg:col-span-2" width={158} height={48} />
                    ) : (
                      <SponsorCard {...sponsor} />
                    )}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </section>
      
    </div>
  </Container>
</PageLayout>

<style>
  .bg-grid-pattern {
    background-image: radial-gradient(circle, rgba(0,0,0,0.1) 1px, transparent 1px);
    background-size: 20px 20px;
  }
</style>